# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [0.4] - 2025-08-29
### Fixed
- **CRITICAL**: Fixed app crashes during MentraOS settings updates in Android app
- **CRITICAL**: Resolved LLM provider initialization failures with invalid API keys
- **CRITICAL**: Fixed "configuration issue with AI" error for Perplexity LLM (non-tool mode support)
- **CRITICAL**: Fixed Cloud Run health check failures causing container shutdowns

### Changed
- **Settings System**: Implemented proper priority resolution (User Settings > Environment Variables > Defaults)
- **API Key Handling**: Enhanced security with validation and source logging
- **Error Handling**: Added comprehensive error recovery throughout LLM provider system
- **Health Checks**: Replaced custom HTTP endpoint with SDK built-in `healthCheck: true`
- **Logging**: Updated from `console.log` to proper `session.logger` for structured logging

### Added
- **Session-aware LLM Provider**: Pass user settings context to LLM initialization
- **Real-time Settings Sync**: Safe handling of settings changes without crashes  
- **API Key Validation**: Detect placeholder keys and invalid formats
- **Graceful Degradation**: Fallback to default LLM when user settings fail
- **Non-tool Mode**: Support for LLMs that don't support function calling (e.g., Perplexity)

### Technical Details
- Fixed type safety issues in settings resolution that could cause runtime crashes
- Added try-catch protection around all LLM provider instantiations
- Enhanced settings change listeners with proper error handling
- Improved MiraAgent to accept optional session context for settings access
- Added comprehensive logging for API key resolution without exposing sensitive data

### Author
- Dr. Robert Li

## [0.3] - 2025-08-29
### Changed
- **BREAKING CHANGE**: Migrated from Cloudflare Workers to Node.js/Google Cloud Run deployment
- Removed all Cloudflare-specific dependencies:
  - `@cloudflare/workers-types`
  - `wrangler` CLI tool
  - `KVNamespace` and `DurableObject` interfaces
  - `wrangler.toml` and `tsconfig.worker.json` configuration files
- Replaced Cloudflare Durable Objects with in-memory `MentraOSSessionManager`
- Replaced KV storage with memory-based session storage with automatic cleanup
- Updated build system from Cloudflare Workers target to Node.js TypeScript compilation
- Added Docker support with optimized `Dockerfile` for Google Cloud Run
- Added `cloudrun.yaml` for Knative/Google Cloud Run deployment configuration
- Updated package.json scripts:
  - Removed: `build:worker`, `deploy`, `deploy:dev`, `deploy:prod`, `dev:worker`
  - Added: `build:node`, `deploy:gcloud`, `deploy:gcloud:build`
  - Updated: `build` now uses TypeScript + Node.js target, `start` uses Node.js
- Completely rewrote README.md with Google Cloud Run deployment instructions
- Added migration guide explaining changes from Cloudflare Workers
- Environment variables now used instead of Cloudflare secrets for API keys

### Technical Details
- Session management moved from Durable Objects to in-memory Map with auto-cleanup
- Server runs on standard Node.js with Express.js compatibility  
- Docker container optimized for Google Cloud Run (Node.js 18 Alpine)
- Supports deployment to any Node.js platform (AWS ECS, Azure Container Apps, etc.)

### Author
- Dr. Robert Li

## [0.2] - 2025-08-29
### Changed
- Switched Cloudflare Worker entrypoint from `worker-simple.ts` to `index.ts` for full MentraOS SDK integration.
- Bundled `@augmentos/sdk` with esbuild for Cloudflare Workers compatibility.
- Updated build process to use esbuild bundling instead of tsc-only.
- Expanded LLM model support:
  - OpenAI/Azure: GPT‑4o, GPT‑4o‑mini, GPT‑5, GPT‑5‑mini.
  - Anthropic: Claude‑3.5 Sonnet, Claude‑3.5 Haiku, Claude‑4.
  - Google: Gemini‑pro, Gemini‑2.0‑flash, Gemini‑2.0‑flash‑thinking.
  - Perplexity: Sonar, Sonar‑Pro.
- Added support for user-provided API keys via `/settings`.
- Improved error handling and fallback logic in `LLMProvider`.
- Updated documentation (README, setup guides) to reflect new build and deployment requirements.

### Author
- Dr. Robert Li

## [0.1] - 2025-08-29
### Added
- Initial release of **MentraOS-LLM**.
- Integrated multi-LLM provider support (OpenAI, Anthropic, Google, Azure, Perplexity).
- Implemented intelligent notification management and filtering.
- Added location-aware intelligence with reverse geocoding and timezone support.
- Enhanced search capabilities with Jina AI integration.
- Event subscriptions for device state changes (glasses connection, battery, notifications, etc.).
- Updated README with event subscription details.

### Author
- Dr. Robert Li
